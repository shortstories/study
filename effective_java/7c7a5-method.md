# 7장 - Method

## validation을 꼭 하기

1. public 메소드라면 검사하여 적절한 `Exception`을 던지도록 구현한다. 그리고 문서에다가 관련된 사항들을 기입해야한다.
2. public이 아닌 메소드라면 `assert` 를 사용해서 검사하는 것이 권장된다.
3. 검사 자체의 비용이 아주 비싸거나 메소드 실행 가운데 \(메소드 실행 앞 부분이나 다 끝난 다음이 아니라\) 묵시적으로 검사를 실행하고 있다면 생략할 수 있다.

## 필요하다면 방어복사본 만들기

의도는 불변객체를 만드는 것이지만 그 객체의 필드 중에 가변 객체가 있다면 의도치않게 수정이 가능해지는 경우가 있다. 이러한 경우를 막기 위해서 필요하다면 불변객체를 생성할 때 그 필드에다가 원본 객체 대신에 그 객체의 값을 복사한 새로운 객체를 만들어서 할당해야한다. 

### 주의사항

1. validation을 하기 전에 미리 복사본을 만들고, 그 복사본을 바탕으로 validation을 진행해야한다. 왜냐하면 값을 검사하고 나서 복제를 하게 되면 검사가 완료되고 복제를 하려고하는 그 사이 시간에 값을 변경하는 것이 가능하기 때문이다. 
2. `clone` 메소드가 악의적으로 설계된 서브 클래스의 인스턴스를 반환할 수 있기 때문에 `clone` 메소드를 믿으면 안 된다.
3. getter에서도 필드 인스턴스의 복사본을 만들어서 반환하도록 해야 한다. 여기서 차이점은 `clone` 를 써도 된다는 점이다. 왜냐하면 이미 생성 시점에서 검사 완료하고 안전한 인스턴스를 만들어서 넣어두었기 때문이다.
4. 방어복사본을 만드는 것이 성능적으로 불리하므로 내부적으로 안전한 환경이라면 문서화를 적절히 하고 복사본을 쓰는 것을 생략할 수도 있다.



