# CQRS

## 이벤트

* 불변 객체
* 오직 추가만 가능하게 보관
* 이벤트 스토어는 persistance하기만 하다면 무엇이든 상관없음

### 이벤트 리플레이

* 현재 상태를 복원하는 것
* 언제나 해야만 한다?
* 대량의 이벤트가 있다면 성능상 문제가 발생한다.

### 스냅샷

* 이벤트 식별자, 버전, 리플레이 끝난 마지막 도메인 객체를 저장
* 이벤트 저장 시점에 생성
* 시간 내지는 이벤트 발생 개수를 기준으로 생성
* 보통 in-memory 저장소 사용
* 이렇게 하면 리플레이로 인한 비용은 줄일 수 있겠지만, 특정 쿼리에서 너무 느려진다

## CQRS 란?

* 이러한 이벤트 소싱의 성능 한계를 해결하기위해 나옴
* 명령과 조회의 책임 분리
* 커맨드 모델과 쿼리 모델 분리
* 사실상 이벤트 소싱에서 필수라고 보면 됨

### Event Projection

* 커맨드 모델로 이벤트가 발생하면 이벤트 스토어에 저장하고 쿼리 모델로 보내서 쿼리  모델의 저장소를 업데이트 하는 과정



